{% extends "base.html" %}
{% block content %}
<h2>Step 1 · Connect Gmail</h2>
<ol>
    <li><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener">Go to the Gmail API page</a> and click <strong>Enable</strong> for your project.</li>
    <li>Configure the OAuth Consent Screen
        <ul>
            <li>In Google Cloud Console, go to <em>APIs & Services → OAuth consent screen</em>.</li>
            <li>Choose <strong>External</strong> (or <strong>Internal</strong> if using Workspace).</li>
            <li>Enter App name, User support email, and Developer contact information.</li>
            <li>Click <strong>Save and Continue</strong> until finished.</li>
        </ul>
    </li>
    <li>Create OAuth Credentials
        <ul>
            <li>Go to <em>APIs & Services → Credentials</em>.</li>
            <li>Click <strong>Create Credentials → OAuth Client ID</strong>.</li>
            <li>Choose <strong>Web Application</strong>.</li>
            <li>Under <strong>Authorized Redirect URIs</strong>, add your URI:<br>
                <code>&lt;YOUR_REDIRECT_URI_HERE&gt;</code><br>
                <small>(For this app use <code>{{ redirect_uri }}</code>{% if redirect_uri != alt_redirect_uri %}; add <code>{{ alt_redirect_uri }}</code> if you browse via 127.0.0.1{% endif %})</small>
            </li>
            <li>Click <strong>Create</strong>.</li>
        </ul>
    </li>
    <li>Download JSON File
        <ul>
            <li>After creation, download the JSON file.</li>
            <li>Inside the file, look for the fields <code>client_id</code> and <code>client_secret</code>.</li>
            <li>These are the values you will use in your app.</li>
        </ul>
    </li>
</ol>

{% if error %}
    <p class="error">{{ error }}</p>
{% endif %}
{% if message %}
    <p class="success">{{ message }}</p>
{% endif %}

<form method="post" action="/credentials">
    <label for="client_id">Google OAuth Client ID</label>
    <input type="text" id="client_id" name="client_id" placeholder="e.g. 123.apps.googleusercontent.com" required>

    <label for="client_secret">Google OAuth Client Secret</label>
    <input type="password" id="client_secret" name="client_secret" placeholder="Paste client secret" required>

    <button type="submit">Connect Google account</button>
</form>

{% if env_has_oauth %}
<p>
    <em>Or</em>
    <a class="button" href="/auth/google/start">Use server-configured credentials</a>
    <small>(Client ID/Secret are set via environment)</small>
    </p>
{% endif %}

{% if gmail_authorized %}<p class="success">Gmail connected ✔</p>{% endif %}

<p><a class="button button-outline" href="/recipients">Next: Upload recipients</a></p>
{% endblock %}
